{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.13", "generated_at": "2024-04-25T23:57:54.618340Z", "invocation_id": "90dee541-10fa-4db1-a8a3-0dd979373d3f", "env": {}}, "results": [{"status": "error", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:42.548820Z", "completed_at": "2024-04-25T23:57:42.567793Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:42.571367Z", "completed_at": "2024-04-25T23:57:44.110890Z"}], "thread_id": "Thread-1", "execution_time": 1.573387861251831, "adapter_response": {}, "message": "Database Error in model corrupt_user_id (models/push_problem/corrupt_user_id.sql)\n  Syntax error: Expected end of input but got keyword SELECT at [29:1]\n  compiled Code at target/run/dbt_octafx/models/push_problem/corrupt_user_id.sql", "failures": null, "unique_id": "model.dbt_octafx.corrupt_user_id", "compiled": true, "compiled_code": "SELECT\n  `failed_pushes_users`.appsflyer_id `failed_pushes_users__appsflyer_id`,\n  `failed_pushes_users`.user_id `failed_pushes_users__user_id`\nFROM\n  (\n    SELECT\n      e.user_id,\n      a.appsflyer_id\n    FROM\n      `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` e\n      INNER JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` a ON e.user_id = a.user_id\n    WHERE\n      e.timestamp > '2024-01-01T00:00:00.000'\n      AND e.timestamp < '2024-12-31T23:59:59.999'\n      AND (\n        e.action_type = 'mobile notification'\n      )\n      AND (e.status = 'failed')\n      AND (a.appsflyer_id is not null)\n    GROUP BY\n      1,\n      2\n  ) AS `failed_pushes_users`\nSELECT\n  `failed_pushes_users`.appsflyer_id `failed_pushes_users__appsflyer_id`,\n  `failed_pushes_users`.user_id `failed_pushes_users__user_id`\nFROM\n  (\n    SELECT\n      e.user_id,\n      a.appsflyer_id\n    FROM\n      `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` e\n      INNER JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` a ON e.user_id = a.user_id\n    WHERE\n      e.timestamp > '2024-01-01T00:00:00.000'\n      AND e.timestamp < '2024-12-31T23:59:59.999'\n      AND (\n        e.action_type = 'mobile notification'\n      )\n      AND (e.status = 'failed')\n      AND (a.appsflyer_id is not null)\n    GROUP BY\n      1,\n      2\n  ) AS `failed_pushes_users`\nGROUP BY\n  1,\n  2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`corrupt_user_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:42.563424Z", "completed_at": "2024-04-25T23:57:42.568809Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:42.595784Z", "completed_at": "2024-04-25T23:57:44.136155Z"}], "thread_id": "Thread-4", "execution_time": 1.5936119556427002, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "20adcd81-3c45-432d-944e-4b40863816df", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_af_events", "compiled": true, "compiled_code": "SELECT\n    af.id,\n    af.appsflyer_id\n    -- , af_id.user_id\n    , media_source\n    , af_channel\n    , campaign\n    , country_code\n    , af.ip\n    , af.platform\n    , af.device_type\n    , af.os_version\n    , af.app_version\n    , af.sdk_version\n    , af.app_id\n    , af.app_name\n    , af.bundle_id\n    , af.event_name\n    , af.event_value\n    , af.device_model\n    , af.device_brand\n    , af.event_type\n    , af.event_time_dt\n    , af.install_time_dt\n    , af.store_reinstall\n    , af.install_app_store\nFROM `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\nWHERE af.event_time_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_af_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:44.149427Z", "completed_at": "2024-04-25T23:57:44.153870Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:44.154547Z", "completed_at": "2024-04-25T23:57:45.590204Z"}], "thread_id": "Thread-4", "execution_time": 1.4451429843902588, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "bf895bfa-c690-40e7-9b32-3ccb7390bbc9", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_users", "compiled": true, "compiled_code": "select\n    user_id,\n    country_code,\n    registered_dt\nfrom\n    `analytics-147612`.`wh_raw`.`users`\nwhere registered_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:44.122081Z", "completed_at": "2024-04-25T23:57:44.136505Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:44.142389Z", "completed_at": "2024-04-25T23:57:45.596295Z"}], "thread_id": "Thread-1", "execution_time": 1.4774129390716553, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "51852d4d-3d23-4705-9279-24fdfb6bd201", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_bloomreach_events", "compiled": true, "compiled_code": "\n\nselect\n    c.type,\n    c.internal_customer_id,\n    c.ingest_timestamp,\n    c.timestamp,\n    properties.action_type,\n    properties.campaign_trigger,\n    properties.language,\n    properties.platform,\n    properties.campaign_name,\n    properties.action_id,\n    properties.campaign_policy,\n    -- properties.subject,\n    properties.action_name,\n    properties.recipient,\n    -- properties.message,\n    properties.sent_timestamp,\n    properties.consent_category,\n    properties.campaign_id,\n    properties.status,\n    properties.integration_id,\n    properties.message_id,\n    properties.integration_name,\n    properties.utm_campaign,\n    properties.utm_medium,\n    properties.utm_source,\n    properties.code,\n    properties.message_type,\n    properties.sender,\n    properties.sending_ip,\n    properties.country,\n    properties.city,\n    properties.ip,\n    properties.state,\n    properties.longitude,\n    properties.status_code,\n    properties.error,\n    properties.event_type,\n    properties.symbol,\n    properties.redirect_to_screen,\n    properties.template_name,\n    properties.title,\n    properties.attempts,\n    properties.delta_time,\n    properties.os,\n    properties.location,\n    properties.device,\n    properties.action_url,\n    safe_cast(c.user_id as numeric) as user_id\nfrom `analytics-147612`.`bloomreach_raw`.`campaign` as c\nwhere\n    timestamp_trunc(c.timestamp, day) >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:42.551303Z", "completed_at": "2024-04-25T23:57:42.568175Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:42.587675Z", "completed_at": "2024-04-25T23:57:45.890624Z"}], "thread_id": "Thread-2", "execution_time": 3.350555896759033, "adapter_response": {"_message": "CREATE TABLE (257.0 rows, 10.9 KiB processed)", "code": "CREATE TABLE", "rows_affected": 257, "bytes_processed": 11188, "bytes_billed": 20971520, "location": "EU", "project_id": "analytics-147612", "job_id": "f6b36948-c6c2-42fd-a372-f0621030f34e", "slot_ms": 1468}, "message": "CREATE TABLE (257.0 rows, 10.9 KiB processed)", "failures": null, "unique_id": "model.dbt_octafx.countries", "compiled": true, "compiled_code": "\n\nSELECT\n    c.country,\n    c.code,\n    ct.tier,\n    concat(\"Tier \", ct.tier_id) as tier_name\nFROM `analytics-147612`.`wh_raw`.`countries` AS c\nLEFT JOIN\n    `analytics-147612`.`wh_raw`.`countries_tiers` AS ct\n    ON c.country = ct.country", "relation_name": "`analytics-147612`.`dev_gsokolov`.`countries`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:45.607300Z", "completed_at": "2024-04-25T23:57:45.622357Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:45.628268Z", "completed_at": "2024-04-25T23:57:47.253146Z"}], "thread_id": "Thread-4", "execution_time": 1.6498589515686035, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "b24af083-59b1-4515-992a-b68dfbad8be9", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_bloomreach_events_enhanced", "compiled": true, "compiled_code": "SELECT\n    c.*,\n    cp.raw_properties.google_push_notification_id,\n    u.country_code,\n    u.registered_dt\nFROM `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` AS c\nINNER JOIN `analytics-147612`.`dev_gsokolov`.`stg_users` AS u\n    ON safe_cast(c.user_id AS INTEGER) = u.user_id\n    AND TIMESTAMP_TRUNC(\n        c.timestamp, DAY\n    ) BETWEEN u.registered_dt AND u.registered_dt + INTERVAL 28 DAY\n\nLEFT JOIN `analytics-147612`.`bloomreach_raw`.`customers_properties` AS cp\n    ON c.internal_customer_id = cp.internal_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:42.555096Z", "completed_at": "2024-04-25T23:57:44.631865Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:44.636982Z", "completed_at": "2024-04-25T23:57:47.394110Z"}], "thread_id": "Thread-3", "execution_time": 4.848496198654175, "adapter_response": {"_message": "CREATE TABLE (1.0 rows, 0 processed)", "code": "CREATE TABLE", "rows_affected": 1, "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "12fb9475-b81c-41d7-8b8f-8af8fe8901ae", "slot_ms": 155}, "message": "CREATE TABLE (1.0 rows, 0 processed)", "failures": null, "unique_id": "model.dbt_octafx.dummy_id", "compiled": true, "compiled_code": "\n\nSELECT 17367040 as user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`dummy_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:45.902069Z", "completed_at": "2024-04-25T23:57:45.907912Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:45.909272Z", "completed_at": "2024-04-25T23:57:47.565006Z"}], "thread_id": "Thread-2", "execution_time": 1.6650640964508057, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "d59c34ba-70b1-4008-8bca-6f780a1975d5", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_pushes", "compiled": true, "compiled_code": "select ue.*\nfrom `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` as ue\nwhere action_type = 'mobile notification'\nand status in ('delivered', 'clicked', 'failed')", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_pushes`"}, {"status": "error", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:45.614350Z", "completed_at": "2024-04-25T23:57:45.621207Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:45.623009Z", "completed_at": "2024-04-25T23:57:48.524340Z"}], "thread_id": "Thread-1", "execution_time": 2.9210879802703857, "adapter_response": {}, "message": "Database Error in model int_pushes (models/push_problem/int_pushes.sql)\n  Table-valued function not found: source at [39:9]\n  compiled Code at target/run/dbt_octafx/models/push_problem/int_pushes.sql", "failures": null, "unique_id": "model.dbt_octafx.int_pushes", "compiled": true, "compiled_code": "\n\nwith\n    users as (\n\n        select user_id, registered_dt, country\n        from `analytics-147612`.`wh_raw`.`users`\n        where registered_dt >= '2024-01-01'\n\n    ),\n\n    countries as (select * from `analytics-147612`.`wh_raw`.`countries`),\n    \n    tokens as (\n        select internal_id, raw_properties.google_push_notification_id as token\n        from `analytics-147612`.`bloomreach_raw`.`customers_properties`\n    ),\n\n    users_countries as (\n\n        select user_id, registered_dt, code\n        from users u\n        left join countries c on u.country = c.country\n    ),\n\n    filtered_events as (\n        select *\n        from `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events`\n        where action_type = 'mobile notification' and status = 'delivered'\n    ),\n\n    installed as (\n        select customer_user_id, event_time_dt from \n        source('wh_raw', 'mobile_appsflyer')\n        where event_time_dt >= '2024-01-01'\n        AND event_type = 'install'\n    ),\n\n    temp as (\n        select\n            uc.user_id,\n            t.token,\n            b.* except (user_id)\n        from users_countries uc\n        inner join filtered_events f on uc.user_id = f.user_id\n        left join\n            `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` b\n            on uc.user_id = b.user_id\n        inner join installed i on uc.user_id = i.customer_user_id\n        left join tokens t on b.internal_customer_id = t.internal_id\n\n    )\n\nselect *\nfrom temp\nwhere action_type = 'mobile notification'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:47.260357Z", "completed_at": "2024-04-25T23:57:47.266490Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:47.267774Z", "completed_at": "2024-04-25T23:57:48.961739Z"}], "thread_id": "Thread-4", "execution_time": 1.704456090927124, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "4c37dde0-8850-4d2a-b6bd-3a2315c52314", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_af_id", "compiled": true, "compiled_code": "SELECT\n    cast(user_id as numeric) as user_id\n    , client_id AS appsflyer_id\n    , af.install_time_dt\nFROM (\n    SELECT\n        *\n        , ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY dt DESC) AS row_num\n    FROM `analytics-147612`.`wh_raw`.`users_cids_all`\n    WHERE user_id IN (SELECT DISTINCT user_id FROM `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`)\n) AS s\n    INNER JOIN `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\n        ON s.client_id = af.appsflyer_id\n            AND af.event_time_dt >= '2024-01-01'\nWHERE s.row_num = 1", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_af_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:47.570515Z", "completed_at": "2024-04-25T23:57:47.575184Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:47.576151Z", "completed_at": "2024-04-25T23:57:49.054643Z"}], "thread_id": "Thread-3", "execution_time": 1.4858949184417725, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "c9f65f01-5ff5-40a4-8ff0-6c9bfb6a2fdc", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_notreg_pushes", "compiled": true, "compiled_code": "select *\nfrom `analytics-147612`.`dev_gsokolov`.`stg_pushes`\nwhere status = 'failed' and error = 'NotRegistered'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:48.973877Z", "completed_at": "2024-04-25T23:57:48.985713Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:48.988037Z", "completed_at": "2024-04-25T23:57:50.606912Z"}], "thread_id": "Thread-1", "execution_time": 1.6355762481689453, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "ef21afd7-5470-4369-a0d2-b8c33ef82373", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_users_af", "compiled": true, "compiled_code": "select\n    u.*,\n    af.appsflyer_id,\n    af.install_time_dt\nfrom `analytics-147612`.`dev_gsokolov`.`stg_users` as u\ninner join\n    `analytics-147612`.`dev_gsokolov`.`int_af_id` as af\n    on u.user_id = af.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_users_af`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:48.967448Z", "completed_at": "2024-04-25T23:57:48.981363Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:48.982362Z", "completed_at": "2024-04-25T23:57:50.676890Z"}], "thread_id": "Thread-2", "execution_time": 1.7124648094177246, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "65f783fe-d65c-4b77-a991-96a87e14c8fc", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.avg_timedelta_per_user", "compiled": true, "compiled_code": "\n\nWITH RankedEvents AS (\n  SELECT\n    i.appsflyer_id,\n    e.timestamp,\n    e.status,\n    e.action_id,\n    e.action_type,\n    e.campaign_name,\n    ROW_NUMBER() OVER (PARTITION BY i.appsflyer_id ORDER BY e.timestamp ASC) AS rank\n  FROM\n    `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n    LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\n  WHERE\n    e.action_type = 'mobile notification'\n),\nFailedEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS failed_timestamp\n  FROM RankedEvents\n  WHERE status = 'failed'\n),\nFirstAttemptEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS first_attempt_timestamp\n  FROM RankedEvents\n  WHERE rank = 1\n),\nTimeDeltas AS (\n  SELECT\n    f.appsflyer_id,\n    TIMESTAMP_DIFF(f.failed_timestamp, a.first_attempt_timestamp, SECOND) AS time_delta_seconds\n  FROM\n    FailedEvents f\n    JOIN FirstAttemptEvents a ON f.appsflyer_id = a.appsflyer_id\n)\nSELECT\n  AVG(time_delta_seconds) AS avg_time_delta_seconds\nFROM\n  TimeDeltas", "relation_name": "`analytics-147612`.`dev_gsokolov`.`avg_timedelta_per_user`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:48.977697Z", "completed_at": "2024-04-25T23:57:48.986551Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:48.991803Z", "completed_at": "2024-04-25T23:57:50.685669Z"}], "thread_id": "Thread-4", "execution_time": 1.7137031555175781, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "9cf37786-f9d1-421f-adea-9439380e95d8", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.timedelta_helper", "compiled": true, "compiled_code": "SELECT\n  i.appsflyer_id,\n  CASE\n    WHEN status = 'failed' THEN 1\n    WHEN status != 'failed' THEN 0\n  END as if_failed,\n  e.timestamp,\n  e.status,\n  e.action_id,\n  e.action_type,\n  e.campaign_name\nFROM\n  `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n  LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\nWHERE\n  (\n    e.action_type = 'mobile notification'\n  )", "relation_name": "`analytics-147612`.`dev_gsokolov`.`timedelta_helper`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:49.058655Z", "completed_at": "2024-04-25T23:57:49.062443Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:49.063049Z", "completed_at": "2024-04-25T23:57:50.756072Z"}], "thread_id": "Thread-3", "execution_time": 1.6989290714263916, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "fe72c5be-08e5-4b47-981d-4dd1f3876b3b", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.timedelta_per_user", "compiled": true, "compiled_code": "\n\nWITH RankedEvents AS (\n  SELECT\n    i.appsflyer_id,\n    e.timestamp,\n    e.status,\n    e.action_id,\n    e.action_type,\n    e.campaign_name,\n    ROW_NUMBER() OVER (PARTITION BY i.appsflyer_id ORDER BY e.timestamp ASC) AS rank\n  FROM\n    `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n    LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\n  WHERE\n    e.action_type = 'mobile notification'\n),\nFailedEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS failed_timestamp\n  FROM RankedEvents\n  WHERE status = 'failed'\n),\nFirstAttemptEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS first_attempt_timestamp\n  FROM RankedEvents\n  WHERE rank = 1\n)\nSELECT\n  f.appsflyer_id,\n  f.failed_timestamp,\n  a.first_attempt_timestamp,\n  TIMESTAMP_DIFF(f.failed_timestamp, a.first_attempt_timestamp, SECOND) AS time_delta_seconds\nFROM\n  FailedEvents f\n  JOIN FirstAttemptEvents a ON f.appsflyer_id = a.appsflyer_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`timedelta_per_user`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:50.610763Z", "completed_at": "2024-04-25T23:57:50.614807Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:50.615413Z", "completed_at": "2024-04-25T23:57:52.185237Z"}], "thread_id": "Thread-1", "execution_time": 1.576225996017456, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "dffe48ad-433f-4c78-9d24-d551f751c401", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_notreg_user_id", "compiled": true, "compiled_code": "with\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`\n    where error = \"NotRegistered\"\n    group by user_id\n)\n\nselect distinct\n    uep.user_id,\n    fnr.first_error_timestamp\nfrom `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes` as uep\ninner join first_not_registered as fnr on uep.user_id = fnr.user_id\ngroup by 1, 2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:52.195575Z", "completed_at": "2024-04-25T23:57:52.200137Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:52.205098Z", "completed_at": "2024-04-25T23:57:53.839844Z"}], "thread_id": "Thread-4", "execution_time": 1.6504309177398682, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "511597db-842c-40fe-9d90-018ee1cabfef", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_pushes_enum", "compiled": true, "compiled_code": "with\n    pushes as (\n        select\n            *,\n            row_number() over (\n                partition by user_id order by cast(timestamp as datetime)\n            ) as event_number\n        from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n        where user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`)\n        and (action_type = 'mobile notification' and status in ('delivered', 'clicked', 'failed'))\n    ),\n    first_not_registered as (\n        select\n            user_id,\n            min(cast(timestamp as datetime)) as first_error_timestamp,\n            min(event_number) as first_error_event_number\n        from pushes\n        where error = \"NotRegistered\"\n        group by user_id\n    ),\n    first_error_event as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from\n        pushes\n    where\n        error = 'NotRegistered'\n    group by\n        user_id\n),\nnext_delivered_event as (\n    select\n        e.user_id,\n        min(cast(e.timestamp as datetime)) as next_delivered_timestamp\n    from\n        pushes e\n    join\n        first_error_event fee on e.user_id = fee.user_id\n    where\n        e.status = 'delivered' and cast(e.timestamp as datetime) > fee.first_error_timestamp\n    group by\n        e.user_id\n)\nselect\n    fee.user_id,\n    fee.first_error_timestamp,\n    nde.next_delivered_timestamp,\n    date_diff(nde.next_delivered_timestamp, fee.first_error_timestamp, second) as time_difference_in_seconds\nfrom\n    first_error_event fee\nleft join\n    next_delivered_event nde on fee.user_id = nde.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_pushes_enum`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-25T23:57:52.191969Z", "completed_at": "2024-04-25T23:57:52.199021Z"}, {"name": "execute", "started_at": "2024-04-25T23:57:52.200485Z", "completed_at": "2024-04-25T23:57:54.592295Z"}], "thread_id": "Thread-2", "execution_time": 2.4027388095855713, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "80b4d1bc-b2a3-4283-9212-b7e884d06319", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_events_enum", "compiled": true, "compiled_code": "with\nevents as (\n    select\n        *,\n        row_number() over (\n            partition by user_id order by cast(timestamp as datetime)\n        ) as event_number\n    from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n    where\n        user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`)\n        and status in ('delivered', 'clicked', 'failed')\n),\n\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp,\n        min(event_number) as first_error_event_number\n    from events\n    where error = \"NotRegistered\"\n    group by user_id\n)\n\nselect\n    cast(e.user_id as numeric) as user_id,\n    country_code,\n    registered_dt,\n    status,\n    campaign_id,\n    consent_category,\n    sent_timestamp,\n    action_name,\n    action_id,\n    campaign_name,\n    platform,\n    campaign_trigger,\n    action_type,\n    ingest_timestamp,\n    timestamp,\n    type,\n    fnr.first_error_timestamp,\n    cast(fnr.first_error_event_number as numeric) as first_error_event_number\nfrom events as e\nleft join first_not_registered as fnr on e.user_id = fnr.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_events_enum`"}], "elapsed_time": 15.545529842376709, "args": {"static_parser": true, "populate_cache": true, "invocation_command": "dbt build --select push_problem", "log_level": "info", "resource_types": [], "favor_state": false, "print": true, "show_resource_report": false, "partial_parse": true, "send_anonymous_usage_stats": true, "warn_error_options": {"include": [], "exclude": []}, "partial_parse_file_diff": true, "show": false, "select": ["push_problem"], "log_format": "default", "use_colors_file": true, "defer": false, "printer_width": 80, "enable_legacy_logger": false, "indirect_selection": "eager", "log_level_file": "debug", "write_json": true, "profiles_dir": "/Users/gsokolov/.dbt", "project_dir": "/Users/gsokolov/Dropbox/dbt_octafx", "exclude": [], "use_colors": true, "strict_mode": false, "which": "build", "log_format_file": "debug", "cache_selected_only": false, "log_path": "/Users/gsokolov/Dropbox/dbt_octafx/logs", "log_file_max_bytes": 10485760, "quiet": false, "macro_debugging": false, "vars": {}, "version_check": true, "introspect": true, "include_saved_query": false}}