{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.12", "generated_at": "2024-04-23T23:19:55.271431Z", "invocation_id": "911dc745-a1a5-441f-841f-c6b6672baa0f", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.615957Z", "completed_at": "2024-04-23T23:19:52.624557Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.626765Z", "completed_at": "2024-04-23T23:19:52.626798Z"}], "thread_id": "Thread-2", "execution_time": 0.022013187408447266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.appsflyer_uninstall_events_report", "compiled": true, "compiled_code": "with source as (\n\n    select * from `analytics-147612`.`wh_raw`.`appsflyer_uninstall_events_report`\n\n),\n\nrenamed as (\n\n    select\n        install_time,\n        event_time,\n        event_value,\n        campaign,\n        campaign_id,\n        region,\n        country_code,\n        appsflyer_id,\n        customer_user_id,\n        platform,\n        os_version,\n        app_version,\n        sdk_version,\n        app_id,\n        app_name,\n        bundle_id,\n        user_agent,\n        google_play_referrer,\n        google_play_click_time,\n        google_play_install_begin_time\n\n    from source\n\n)\n\nselect * from renamed", "relation_name": "`analytics-147612`.`dev_gsokolov`.`appsflyer_uninstall_events_report`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.609085Z", "completed_at": "2024-04-23T23:19:52.624953Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.627571Z", "completed_at": "2024-04-23T23:19:52.627580Z"}], "thread_id": "Thread-1", "execution_time": 0.02361011505126953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.ab_users", "compiled": true, "compiled_code": "WITH\neligible AS (\n    SELECT\n        properties.variant AS variant,\n        SAFE_CAST(user_id AS INT64) AS user_id\n    FROM `analytics-147612`.`bloomreach_raw`.`campaign`\n    WHERE\n        campaign_id = \"65733b51df03a1daadeb772d\"\n        AND action_id = 437\n)\n\nSELECT\n    user_id,\n    variant\nFROM eligible\n", "relation_name": "`analytics-147612`.`dev_gsokolov`.`ab_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.619647Z", "completed_at": "2024-04-23T23:19:52.625311Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.627936Z", "completed_at": "2024-04-23T23:19:52.627944Z"}], "thread_id": "Thread-3", "execution_time": 0.023164033889770508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.corrupt_user_id", "compiled": true, "compiled_code": "SELECT\n  `failed_pushes_users`.appsflyer_id `failed_pushes_users__appsflyer_id`,\n  `failed_pushes_users`.user_id `failed_pushes_users__user_id`\nFROM\n  (\n    SELECT\n      e.user_id,\n      a.appsflyer_id\n    FROM\n      `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` e\n      INNER JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` a ON e.user_id = a.user_id\n    WHERE\n      e.timestamp > '2024-01-01T00:00:00.000'\n      AND e.timestamp < '2024-12-31T23:59:59.999'\n      AND (\n        e.action_type = 'mobile notification'\n      )\n      AND (e.status = 'failed')\n      AND (a.appsflyer_id is not null)\n    GROUP BY\n      1,\n      2\n  ) AS `failed_pushes_users`\nSELECT\n  `failed_pushes_users`.appsflyer_id `failed_pushes_users__appsflyer_id`,\n  `failed_pushes_users`.user_id `failed_pushes_users__user_id`\nFROM\n  (\n    SELECT\n      e.user_id,\n      a.appsflyer_id\n    FROM\n      `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` e\n      INNER JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` a ON e.user_id = a.user_id\n    WHERE\n      e.timestamp > '2024-01-01T00:00:00.000'\n      AND e.timestamp < '2024-12-31T23:59:59.999'\n      AND (\n        e.action_type = 'mobile notification'\n      )\n      AND (e.status = 'failed')\n      AND (a.appsflyer_id is not null)\n    GROUP BY\n      1,\n      2\n  ) AS `failed_pushes_users`\nGROUP BY\n  1,\n  2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`corrupt_user_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.621361Z", "completed_at": "2024-04-23T23:19:52.625922Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.629090Z", "completed_at": "2024-04-23T23:19:52.629095Z"}], "thread_id": "Thread-4", "execution_time": 0.023601055145263672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.countries", "compiled": true, "compiled_code": "\n\nSELECT\n    c.country,\n    c.code,\n    ct.tier,\n    concat(\"Tier \", ct.tier_id) as tier_name\nFROM `analytics-147612`.`wh_raw`.`countries` AS c\nLEFT JOIN\n    `analytics-147612`.`wh_raw`.`countries_tiers` AS ct\n    ON c.country = ct.country", "relation_name": "`analytics-147612`.`dev_gsokolov`.`countries`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.635219Z", "completed_at": "2024-04-23T23:19:52.657062Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.659925Z", "completed_at": "2024-04-23T23:19:52.659933Z"}], "thread_id": "Thread-2", "execution_time": 0.029038190841674805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.funnel_bloomreach_events", "compiled": true, "compiled_code": "\n\nSELECT\n  action_id,\n  properties.action_name,\n  properties.action_type,\n  campaign_id,\n  event_number,\n  properties.platform,\n  properties.status,\n  timestamp,\n  user_id,\n  properties.variant\nFROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (\n        PARTITION BY user_id\n        ORDER BY\n          timestamp ASC\n      ) AS event_number\n    FROM\n      `analytics-147612`.`bloomreach_raw`.`campaign`\n    WHERE\n      timestamp >= '2024-04-01' and \n      properties.action_type in ('mobile notification', 'email', 'split')\n  ) AS bloomreach_events\nGROUP BY\n  action_id,\n  properties.action_name,\n  properties.action_type,\n  campaign_id,\n  event_number,\n  properties.platform,\n  properties.status,\n  timestamp,\n  user_id,\n  properties.variant", "relation_name": "`analytics-147612`.`dev_gsokolov`.`funnel_bloomreach_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.638522Z", "completed_at": "2024-04-23T23:19:52.657422Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.660369Z", "completed_at": "2024-04-23T23:19:52.660374Z"}], "thread_id": "Thread-1", "execution_time": 0.028866052627563477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.funnel_deals", "compiled": true, "compiled_code": "\n\nSELECT\n    user_id\n    , cmd\n    , open_time_dt AS timestamp\n    , symbol_name\nFROM `analytics-147612`.`wh_raw`.`trading_real_raw`\nWHERE open_time_dt >= TIMESTAMP_TRUNC(TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 30 DAY), MONTH)\n    AND open_time_dt < TIMESTAMP_TRUNC(CURRENT_TIMESTAMP(), DAY) and cmd < 2\n    and symbol_name = 'XAUUSD'\nGROUP BY user_id, cmd, timestamp, symbol_name", "relation_name": "`analytics-147612`.`dev_gsokolov`.`funnel_deals`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.654312Z", "completed_at": "2024-04-23T23:19:52.657898Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.660680Z", "completed_at": "2024-04-23T23:19:52.660684Z"}], "thread_id": "Thread-4", "execution_time": 0.02806878089904785, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.stg_af_events", "compiled": true, "compiled_code": "SELECT\n    af.id,\n    af.appsflyer_id\n    -- , af_id.user_id\n    , media_source\n    , af_channel\n    , campaign\n    , country_code\n    , af.ip\n    , af.platform\n    , af.device_type\n    , af.os_version\n    , af.app_version\n    , af.sdk_version\n    , af.app_id\n    , af.app_name\n    , af.bundle_id\n    , af.event_name\n    , af.event_value\n    , af.device_model\n    , af.device_brand\n    , af.event_type\n    , af.event_time_dt\n    , af.install_time_dt\n    , af.store_reinstall\n    , af.install_app_store\nFROM `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\nWHERE af.event_time_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_af_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.670545Z", "completed_at": "2024-04-23T23:19:52.673207Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.674682Z", "completed_at": "2024-04-23T23:19:52.674696Z"}], "thread_id": "Thread-4", "execution_time": 0.011370182037353516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.tokens", "compiled": true, "compiled_code": "WITH source AS (\n    SELECT\n        *\n    FROM\n        `analytics-147612`.`bloomreach_raw`.`customers_properties`\n),\nrenamed AS (\n    SELECT\n        raw_properties.user_id,\n        raw_properties.google_push_notification_id\n    FROM\n        source\n)\nSELECT\n    *\nFROM\n    renamed", "relation_name": "`analytics-147612`.`dev_gsokolov`.`tokens`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.668600Z", "completed_at": "2024-04-23T23:19:52.673950Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.676321Z", "completed_at": "2024-04-23T23:19:52.676326Z"}], "thread_id": "Thread-1", "execution_time": 0.013275146484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.stg_users", "compiled": true, "compiled_code": "select\n    user_id,\n    country_code,\n    registered_dt\nfrom\n    `analytics-147612`.`wh_raw`.`users`\nwhere registered_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.665695Z", "completed_at": "2024-04-23T23:19:52.674304Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.676637Z", "completed_at": "2024-04-23T23:19:52.676640Z"}], "thread_id": "Thread-2", "execution_time": 0.014275789260864258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.stg_bloomreach_events", "compiled": true, "compiled_code": "\n\nselect\n    c.type,\n    c.internal_customer_id,\n    c.ingest_timestamp,\n    c.timestamp,\n    properties.action_type,\n    properties.campaign_trigger,\n    properties.language,\n    properties.platform,\n    properties.campaign_name,\n    properties.action_id,\n    properties.campaign_policy,\n    -- properties.subject,\n    properties.action_name,\n    properties.recipient,\n    -- properties.message,\n    properties.sent_timestamp,\n    properties.consent_category,\n    properties.campaign_id,\n    properties.status,\n    properties.integration_id,\n    properties.message_id,\n    properties.integration_name,\n    properties.utm_campaign,\n    properties.utm_medium,\n    properties.utm_source,\n    properties.code,\n    properties.message_type,\n    properties.sender,\n    properties.sending_ip,\n    properties.country,\n    properties.city,\n    properties.ip,\n    properties.state,\n    properties.longitude,\n    properties.status_code,\n    properties.error,\n    properties.event_type,\n    properties.symbol,\n    properties.redirect_to_screen,\n    properties.template_name,\n    properties.title,\n    properties.attempts,\n    properties.delta_time,\n    properties.os,\n    properties.location,\n    properties.device,\n    properties.action_url,\n    safe_cast(c.user_id as numeric) as user_id\nfrom `analytics-147612`.`bloomreach_raw`.`campaign` as c\nwhere\n    timestamp_trunc(c.timestamp, day) >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.684270Z", "completed_at": "2024-04-23T23:19:52.686453Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.689810Z", "completed_at": "2024-04-23T23:19:52.689818Z"}], "thread_id": "Thread-1", "execution_time": 0.011657238006591797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_octafx.ETHUSD_random", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.687051Z", "completed_at": "2024-04-23T23:19:52.688207Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.690112Z", "completed_at": "2024-04-23T23:19:52.690115Z"}], "thread_id": "Thread-2", "execution_time": 0.011997222900390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_octafx.XNGUSD_random", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.680414Z", "completed_at": "2024-04-23T23:19:52.688573Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.690414Z", "completed_at": "2024-04-23T23:19:52.690417Z"}], "thread_id": "Thread-4", "execution_time": 0.014425992965698242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.users_cids_all", "compiled": true, "compiled_code": "\n\nwith source as (\n\n    select * from `analytics-147612`.`wh_raw`.`users_cids_all`\n\n),\n\nrenamed as (\n\n    select\n        client_id,\n        user_id,\n        dt,\n        src_info\n\n    from source\n\n)\n\nselect * from renamed", "relation_name": "`analytics-147612`.`dev_gsokolov`.`users_cids_all`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.696980Z", "completed_at": "2024-04-23T23:19:52.713033Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.714389Z", "completed_at": "2024-04-23T23:19:52.714402Z"}], "thread_id": "Thread-1", "execution_time": 0.021426916122436523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.user_deals", "compiled": true, "compiled_code": "SELECT \n    u.user_id,\n    u.variant,\n    COALESCE(t.operation_id, 0) AS operation_id,\n    COALESCE(t.symbol_name, '') AS symbol_name,\n    COALESCE(t.cmd, 0) AS cmd,\n    COALESCE(t.volume, 0) AS volume,\n    COALESCE(t.open_price, 0) AS open_price,\n    COALESCE(t.close_price, 0) AS close_price,\n    COALESCE(t.profit, 0) AS profit,\n    COALESCE(t.open_time_dt, CAST('1970-01-01' AS TIMESTAMP)) AS open_time_dt,\n    COALESCE(t.close_time_dt, CAST('1970-01-01' AS TIMESTAMP)) AS close_time_dt,\n    COALESCE(DATE(DATE_TRUNC(t.open_time_dt, DAY)), DATE('1970-01-01')) AS trade_day\nFROM \n    `analytics-147612`.`dev_gsokolov`.`ab_users` u\n    LEFT JOIN `analytics-147612`.`wh_raw`.`trading_real_raw` AS t ON u.user_id = t.user_id\n        AND (DATE(t.open_time_dt) BETWEEN '2024-04-02' AND '2024-04-09')\n        AND (DATE(t.close_time_dt) BETWEEN '2024-04-02' AND '2024-04-09')\n        AND t.cmd < 2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`user_deals`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.707427Z", "completed_at": "2024-04-23T23:19:52.714971Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.717137Z", "completed_at": "2024-04-23T23:19:52.717147Z"}], "thread_id": "Thread-4", "execution_time": 0.022711753845214844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.event_stream", "compiled": true, "compiled_code": "\n\n\n\n\nWITH bloomreach_events AS (\n    SELECT\n        action_type AS event_type,\n        timestamp,\n        cast(user_id as int) user_id,\n        'communication' AS event_nature\n    FROM\n        `analytics-147612`.`dev_gsokolov`.`funnel_bloomreach_events`\n    WHERE\n        timestamp >= '2024-04-01' AND\n        timestamp <= '2024-04-10'\n),\n\ndeals AS (\n    SELECT\n        cast(cmd as string) AS event_type,\n        timestamp,\n        user_id,\n        'deal' AS event_nature\n    FROM\n        `analytics-147612`.`dev_gsokolov`.`funnel_deals`\n    WHERE\n        timestamp >= '2024-04-01' AND\n        timestamp <= '2024-04-10'\n)\n\nSELECT * FROM bloomreach_events\nUNION ALL\nSELECT * FROM deals\nORDER BY user_id, timestamp", "relation_name": "`analytics-147612`.`dev_gsokolov`.`event_stream`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.719876Z", "completed_at": "2024-04-23T23:19:52.728107Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.728915Z", "completed_at": "2024-04-23T23:19:52.728925Z"}], "thread_id": "Thread-1", "execution_time": 0.012222051620483398, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_bloomreach_events_enhanced", "compiled": true, "compiled_code": "SELECT\n    c.*,\n    cp.raw_properties.google_push_notification_id,\n    u.country_code,\n    u.registered_dt\nFROM `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` AS c\nINNER JOIN `analytics-147612`.`dev_gsokolov`.`stg_users` AS u\n    ON safe_cast(c.user_id AS INTEGER) = u.user_id\n    AND TIMESTAMP_TRUNC(\n        c.timestamp, DAY\n    ) BETWEEN u.registered_dt AND u.registered_dt + INTERVAL 28 DAY\n\nLEFT JOIN `analytics-147612`.`bloomreach_raw`.`customers_properties` AS cp\n    ON c.internal_customer_id = cp.internal_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.725117Z", "completed_at": "2024-04-23T23:19:52.729233Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.731144Z", "completed_at": "2024-04-23T23:19:52.731151Z"}], "thread_id": "Thread-4", "execution_time": 0.008233070373535156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.stg_pushes", "compiled": true, "compiled_code": "select ue.*\nfrom `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` as ue\nwhere action_type = 'mobile notification'\nand status in ('delivered', 'clicked', 'failed')", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.741527Z", "completed_at": "2024-04-23T23:19:52.746270Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.746946Z", "completed_at": "2024-04-23T23:19:52.746953Z"}], "thread_id": "Thread-4", "execution_time": 0.008338212966918945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.ab_stats", "compiled": true, "compiled_code": "WITH stats AS (\n    SELECT\n        user_id,\n        variant,\n        COUNT(DISTINCT operation_id) AS deals_cnt,\n        COALESCE(SUM(volume), 0) AS symbol_volume,\n        COALESCE(\n            SUM(\n                CASE\n                    WHEN\n                        symbol_name = 'XAUUSD'\n                        THEN volume ELSE\n                        0\n                END\n            ),\n            0\n        ) AS XAUUSD_vol,\n        MIN(\n            CASE\n                WHEN symbol_name = 'XAUUSD' THEN open_time_dt\n            END\n        )\n            AS first_XAUUSD_deal,\n        COALESCE(\n            SUM(\n                CASE\n                    WHEN symbol_name = 'XAUUSD' THEN 1 ELSE 0\n                END\n            ),\n            0\n        )\n            AS XAUUSD_deals_cnt,\n        IF(\n            COALESCE(\n                SUM(\n                    CASE\n                        WHEN\n                            symbol_name = 'XAUUSD'\n                            THEN 1 ELSE\n                            0\n                    END\n                ),\n                0\n            )\n            > 0,\n            1,\n            0\n        ) AS XAUUSD_converted\n    FROM\n        `analytics-147612`.`dev_gsokolov`.`user_deals`\n    GROUP BY\n        user_id, variant\n)\n\nSELECT\n    user_id,\n    variant,\n    deals_cnt,\n    PERCENT_RANK()\n        OVER (PARTITION BY variant ORDER BY deals_cnt)\n        AS deals_cnt_percentile,\n    symbol_volume,\n    PERCENT_RANK()\n        OVER (PARTITION BY variant ORDER BY symbol_volume)\n        AS symbol_volume_percentile,\n    XAUUSD_vol,\n    PERCENT_RANK()\n        OVER (PARTITION BY variant ORDER BY XAUUSD_vol)\n        AS XAUUSD_vol_percentile,\n    COALESCE(CAST(first_XAUUSD_deal AS STRING), 'N/A')\n        AS first_XAUUSD_deal,\n    XAUUSD_deals_cnt,\n    PERCENT_RANK()\n        OVER (PARTITION BY variant ORDER BY XAUUSD_deals_cnt)\n        AS XAUUSD_deals_cnt_percentile,\n    XAUUSD_converted\nFROM\n    stats\nORDER BY\n    deals_cnt DESC", "relation_name": "`analytics-147612`.`dev_gsokolov`.`ab_stats`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.749083Z", "completed_at": "2024-04-23T23:19:52.759560Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.760180Z", "completed_at": "2024-04-23T23:19:52.760187Z"}], "thread_id": "Thread-4", "execution_time": 0.012477874755859375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.funnel_dbt", "compiled": true, "compiled_code": "\n\n\n\n\n  with event_stream as (  \n  select event_nature as event_type, user_id as user_id, timestamp as event_date\n  from `analytics-147612`.`dev_gsokolov`.`event_stream`\n  where 1 = 1\n  \n  \n\n    \n    \n    \n   )\n  \n    , event_stream_step_1 as (\n      select event_stream.* \n      from event_stream\n      \n      where event_stream.event_type = 'communication'\n    )\n\n    , step_1 as (\n      select count(distinct user_id) as unique_users \n      from event_stream_step_1\n    )  \n\n  \n    , event_stream_step_2 as (\n      select event_stream.* \n      from event_stream\n      \n        inner join event_stream_step_1 as previous_events\n          on event_stream.user_id = previous_events.user_id\n          and previous_events.event_type = 'communication'\n          and previous_events.event_date <= event_stream.event_date\n      \n      where event_stream.event_type = 'deal'\n    )\n\n    , step_2 as (\n      select count(distinct user_id) as unique_users \n      from event_stream_step_2\n    )  \n\n  \n\n  , event_funnel as (\n    \n      select 'communication' as event_type, unique_users, 1 as step_index\n      from step_1\n      \n        union all\n      \n    \n      select 'deal' as event_type, unique_users, 2 as step_index\n      from step_2\n      \n    \n  )\n\n  , final as (\n    select event_type\n      , unique_users, 1.0 * unique_users / nullif(first_value(unique_users) over(order by step_index), 0) as pct_conversion\n      , 1.0 * unique_users / nullif(lag(unique_users) over(order by step_index), 0) as pct_of_previous\n    from event_funnel\n  )\n\n  select * from final\n", "relation_name": "`analytics-147612`.`dev_gsokolov`.`funnel_dbt`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.762002Z", "completed_at": "2024-04-23T23:19:52.765779Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.766323Z", "completed_at": "2024-04-23T23:19:52.766330Z"}], "thread_id": "Thread-4", "execution_time": 0.005446195602416992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_af_id", "compiled": true, "compiled_code": "SELECT\n    cast(user_id as numeric) as user_id\n    , client_id AS appsflyer_id\n    , af.install_time_dt\nFROM (\n    SELECT\n        *\n        , ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY dt DESC) AS row_num\n    FROM `analytics-147612`.`wh_raw`.`users_cids_all`\n    WHERE user_id IN (SELECT DISTINCT user_id FROM `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`)\n) AS s\n    INNER JOIN `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\n        ON s.client_id = af.appsflyer_id\n            AND af.event_time_dt >= '2024-01-01'\nWHERE s.row_num = 1", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_af_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.768177Z", "completed_at": "2024-04-23T23:19:52.770759Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.771379Z", "completed_at": "2024-04-23T23:19:52.771386Z"}], "thread_id": "Thread-4", "execution_time": 0.00435185432434082, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_notreg_pushes", "compiled": true, "compiled_code": "select *\nfrom `analytics-147612`.`dev_gsokolov`.`stg_pushes`\nwhere status = 'failed' and error = 'NotRegistered'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.773279Z", "completed_at": "2024-04-23T23:19:52.776858Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.777405Z", "completed_at": "2024-04-23T23:19:52.777412Z"}], "thread_id": "Thread-4", "execution_time": 0.00527191162109375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.ab_stats_grouped", "compiled": true, "compiled_code": "SELECT\n    variant,\n    COUNT(DISTINCT user_id) AS user_count,\n    ROUND(AVG(XAUUSD_vol), 4)\n        AS avg_vol_XAUUSD,\n    ROUND(STDDEV(XAUUSD_vol), 4)\n        AS std_volume_XAUUSD,\n    SUM(XAUUSD_deals_cnt)\n        AS total_deals_XAUUSD,\n    SUM(XAUUSD_vol) AS vol_XAUUSD,\n    SUM(symbol_volume) AS total_vol,\n    SUM(XAUUSD_converted) AS total_converted,\n    SUM(deals_cnt) AS total_deals\nFROM\n    `analytics-147612`.`dev_gsokolov`.`ab_stats`\nGROUP BY variant", "relation_name": "`analytics-147612`.`dev_gsokolov`.`ab_stats_grouped`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.779248Z", "completed_at": "2024-04-23T23:19:52.782416Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.783063Z", "completed_at": "2024-04-23T23:19:52.783070Z"}], "thread_id": "Thread-4", "execution_time": 0.005084991455078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.avg_timedelta_per_user", "compiled": true, "compiled_code": "\n\nWITH RankedEvents AS (\n  SELECT\n    i.appsflyer_id,\n    e.timestamp,\n    e.status,\n    e.action_id,\n    e.action_type,\n    e.campaign_name,\n    ROW_NUMBER() OVER (PARTITION BY i.appsflyer_id ORDER BY e.timestamp ASC) AS rank\n  FROM\n    `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n    LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\n  WHERE\n    e.action_type = 'mobile notification'\n),\nFailedEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS failed_timestamp\n  FROM RankedEvents\n  WHERE status = 'failed'\n),\nFirstAttemptEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS first_attempt_timestamp\n  FROM RankedEvents\n  WHERE rank = 1\n),\nTimeDeltas AS (\n  SELECT\n    f.appsflyer_id,\n    TIMESTAMP_DIFF(f.failed_timestamp, a.first_attempt_timestamp, SECOND) AS time_delta_seconds\n  FROM\n    FailedEvents f\n    JOIN FirstAttemptEvents a ON f.appsflyer_id = a.appsflyer_id\n)\nSELECT\n  AVG(time_delta_seconds) AS avg_time_delta_seconds\nFROM\n  TimeDeltas", "relation_name": "`analytics-147612`.`dev_gsokolov`.`avg_timedelta_per_user`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.784936Z", "completed_at": "2024-04-23T23:19:52.787696Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.788245Z", "completed_at": "2024-04-23T23:19:52.788251Z"}], "thread_id": "Thread-4", "execution_time": 0.004407167434692383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_users_af", "compiled": true, "compiled_code": "select\n    u.*,\n    af.appsflyer_id,\n    af.install_time_dt\nfrom `analytics-147612`.`dev_gsokolov`.`stg_users` as u\ninner join\n    `analytics-147612`.`dev_gsokolov`.`int_af_id` as af\n    on u.user_id = af.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_users_af`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.790029Z", "completed_at": "2024-04-23T23:19:52.792799Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.793426Z", "completed_at": "2024-04-23T23:19:52.793434Z"}], "thread_id": "Thread-4", "execution_time": 0.0046198368072509766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.timedelta_helper", "compiled": true, "compiled_code": "SELECT\n  i.appsflyer_id,\n  CASE\n    WHEN status = 'failed' THEN 1\n    WHEN status != 'failed' THEN 0\n  END as if_failed,\n  e.timestamp,\n  e.status,\n  e.action_id,\n  e.action_type,\n  e.campaign_name\nFROM\n  `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n  LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\nWHERE\n  (\n    e.action_type = 'mobile notification'\n  )", "relation_name": "`analytics-147612`.`dev_gsokolov`.`timedelta_helper`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.795556Z", "completed_at": "2024-04-23T23:19:52.799191Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.799735Z", "completed_at": "2024-04-23T23:19:52.799741Z"}], "thread_id": "Thread-4", "execution_time": 0.005442619323730469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.timedelta_per_user", "compiled": true, "compiled_code": "\n\nWITH RankedEvents AS (\n  SELECT\n    i.appsflyer_id,\n    e.timestamp,\n    e.status,\n    e.action_id,\n    e.action_type,\n    e.campaign_name,\n    ROW_NUMBER() OVER (PARTITION BY i.appsflyer_id ORDER BY e.timestamp ASC) AS rank\n  FROM\n    `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced` as e\n    LEFT JOIN `analytics-147612`.`dev_gsokolov`.`int_af_id` AS i ON e.user_id = i.user_id\n  WHERE\n    e.action_type = 'mobile notification'\n),\nFailedEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS failed_timestamp\n  FROM RankedEvents\n  WHERE status = 'failed'\n),\nFirstAttemptEvents AS (\n  SELECT\n    appsflyer_id,\n    timestamp AS first_attempt_timestamp\n  FROM RankedEvents\n  WHERE rank = 1\n)\nSELECT\n  f.appsflyer_id,\n  f.failed_timestamp,\n  a.first_attempt_timestamp,\n  TIMESTAMP_DIFF(f.failed_timestamp, a.first_attempt_timestamp, SECOND) AS time_delta_seconds\nFROM\n  FailedEvents f\n  JOIN FirstAttemptEvents a ON f.appsflyer_id = a.appsflyer_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`timedelta_per_user`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.801568Z", "completed_at": "2024-04-23T23:19:52.804158Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.804878Z", "completed_at": "2024-04-23T23:19:52.804884Z"}], "thread_id": "Thread-4", "execution_time": 0.004495859146118164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_notreg_user_id", "compiled": true, "compiled_code": "with\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`\n    where error = \"NotRegistered\"\n    group by user_id\n)\n\nselect distinct\n    uep.user_id,\n    fnr.first_error_timestamp\nfrom `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes` as uep\ninner join first_not_registered as fnr on uep.user_id = fnr.user_id\ngroup by 1, 2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.806949Z", "completed_at": "2024-04-23T23:19:52.809469Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.810172Z", "completed_at": "2024-04-23T23:19:52.810179Z"}], "thread_id": "Thread-4", "execution_time": 0.0044269561767578125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_events_enum", "compiled": true, "compiled_code": "with\nevents as (\n    select\n        *,\n        row_number() over (\n            partition by user_id order by cast(timestamp as datetime)\n        ) as event_number\n    from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n    where\n        user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`)\n        and status in ('delivered', 'clicked', 'failed')\n),\n\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp,\n        min(event_number) as first_error_event_number\n    from events\n    where error = \"NotRegistered\"\n    group by user_id\n)\n\nselect\n    cast(e.user_id as numeric) as user_id,\n    country_code,\n    registered_dt,\n    status,\n    campaign_id,\n    consent_category,\n    sent_timestamp,\n    action_name,\n    action_id,\n    campaign_name,\n    platform,\n    campaign_trigger,\n    action_type,\n    ingest_timestamp,\n    timestamp,\n    type,\n    fnr.first_error_timestamp,\n    cast(fnr.first_error_event_number as numeric) as first_error_event_number\nfrom events as e\nleft join first_not_registered as fnr on e.user_id = fnr.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_events_enum`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.812064Z", "completed_at": "2024-04-23T23:19:52.814784Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:52.815334Z", "completed_at": "2024-04-23T23:19:52.815340Z"}], "thread_id": "Thread-4", "execution_time": 0.0044710636138916016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.int_pushes_enum", "compiled": true, "compiled_code": "with\n    pushes as (\n        select\n            *,\n            row_number() over (\n                partition by user_id order by cast(timestamp as datetime)\n            ) as event_number\n        from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n        where user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`)\n        and (action_type = 'mobile notification' and status in ('delivered', 'clicked', 'failed'))\n    ),\n    first_not_registered as (\n        select\n            user_id,\n            min(cast(timestamp as datetime)) as first_error_timestamp,\n            min(event_number) as first_error_event_number\n        from pushes\n        where error = \"NotRegistered\"\n        group by user_id\n    ),\n    first_error_event as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from\n        pushes\n    where\n        error = 'NotRegistered'\n    group by\n        user_id\n),\nnext_delivered_event as (\n    select\n        e.user_id,\n        min(cast(e.timestamp as datetime)) as next_delivered_timestamp\n    from\n        pushes e\n    join\n        first_error_event fee on e.user_id = fee.user_id\n    where\n        e.status = 'delivered' and cast(e.timestamp as datetime) > fee.first_error_timestamp\n    group by\n        e.user_id\n)\nselect\n    fee.user_id,\n    fee.first_error_timestamp,\n    nde.next_delivered_timestamp,\n    date_diff(nde.next_delivered_timestamp, fee.first_error_timestamp, second) as time_difference_in_seconds\nfrom\n    first_error_event fee\nleft join\n    next_delivered_event nde on fee.user_id = nde.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_pushes_enum`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.700069Z", "completed_at": "2024-04-23T23:19:53.640081Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:53.640814Z", "completed_at": "2024-04-23T23:19:53.640821Z"}], "thread_id": "Thread-2", "execution_time": 0.9465320110321045, "adapter_response": {}, "message": null, "failures": null, "unique_id": "analysis.dbt_octafx.codegen", "compiled": true, "compiled_code": "version: 2\n\nmodels:\n  - name: funnel_bloomreach_events\n    description: \"\"\n    columns:\n      - name: action_id\n        data_type: numeric\n        description: \"\"\n\n      - name: action_name\n        data_type: string\n        description: \"\"\n\n      - name: action_type\n        data_type: string\n        description: \"\"\n\n      - name: campaign_id\n        data_type: string\n        description: \"\"\n\n      - name: event_number\n        data_type: int64\n        description: \"\"\n\n      - name: platform\n        data_type: string\n        description: \"\"\n\n      - name: status\n        data_type: string\n        description: \"\"\n\n      - name: timestamp\n        data_type: timestamp\n        description: \"\"\n\n      - name: user_id\n        data_type: string\n        description: \"\"\n\n      - name: variant\n        data_type: string\n        description: \"\"\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.640949Z", "completed_at": "2024-04-23T23:19:54.885864Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:54.886577Z", "completed_at": "2024-04-23T23:19:54.886586Z"}], "thread_id": "Thread-3", "execution_time": 2.2537920475006104, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.metricflow_time_spine", "compiled": true, "compiled_code": "-- filename: metricflow_time_spine.sql\n-- BigQuery supports DATE() instead of TO_DATE(). Use this model if you're using BigQuery\n\nwith days as (\n    \n\n\n    \n\n\n    with rawdata as (\n\n        \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n     + \n    \n    p11.generated_number * power(2, 11)\n     + \n    \n    p12.generated_number * power(2, 12)\n     + \n    \n    p13.generated_number * power(2, 13)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n     cross join \n    \n    p as p12\n     cross join \n    \n    p as p13\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 10958\n    order by generated_number\n\n\n\n    ),\n\n    all_periods as (\n\n        select (\n            \n\n        datetime_add(\n            cast( DATE(2000,01,01) as datetime),\n        interval row_number() over (order by 1) - 1 day\n        )\n\n\n        ) as date_day\n        from rawdata\n\n    ),\n\n    filtered as (\n\n        select *\n        from all_periods\n        where date_day <= DATE(2030,01,01)\n\n    )\n\n    select * from filtered\n\n\n),\n\nfinal as (\n    select cast(date_day as date) as date_day\n    from days\n)\n\nselect *\nfrom final", "relation_name": "`analytics-147612`.`dev_gsokolov`.`metricflow_time_spine`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T23:19:52.733594Z", "completed_at": "2024-04-23T23:19:55.268051Z"}, {"name": "execute", "started_at": "2024-04-23T23:19:55.268763Z", "completed_at": "2024-04-23T23:19:55.268772Z"}], "thread_id": "Thread-1", "execution_time": 2.5378189086914062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_octafx.dummy_id", "compiled": true, "compiled_code": "\n\nSELECT 17367040 as user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`dummy_id`"}], "elapsed_time": 4.712427616119385, "args": {"show_resource_report": false, "log_format_file": "debug", "printer_width": 80, "warn_error_options": {"include": [], "exclude": []}, "print": true, "indirect_selection": "eager", "enable_legacy_logger": false, "select": [], "introspect": true, "log_format": "default", "log_file_max_bytes": 10485760, "profiles_dir": "/Users/gsokolov/.dbt", "log_path": "/Users/gsokolov/Library/CloudStorage/Dropbox/dbt_octafx/logs", "strict_mode": false, "invocation_command": "dbt compile --project-dir=/Users/gsokolov/Library/CloudStorage/Dropbox/dbt_octafx", "inject_ephemeral_ctes": true, "version_check": true, "vars": {}, "use_colors_file": true, "send_anonymous_usage_stats": true, "write_json": true, "partial_parse_file_diff": true, "static_parser": true, "log_level_file": "debug", "exclude": [], "log_level": "info", "quiet": false, "cache_selected_only": false, "use_colors": true, "macro_debugging": false, "project_dir": "/Users/gsokolov/Library/CloudStorage/Dropbox/dbt_octafx", "partial_parse": true, "populate_cache": true, "which": "compile", "favor_state": false, "defer": false, "output": "text"}}