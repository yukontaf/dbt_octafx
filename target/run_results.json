{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.13", "generated_at": "2024-05-03T19:52:58.916612Z", "invocation_id": "cdda8e93-bfff-4195-82e5-cee7d74ec26d", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:52.592936Z", "completed_at": "2024-05-03T19:52:52.602603Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:52.631593Z", "completed_at": "2024-05-03T19:52:53.506567Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.9290063381195068, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "6457420f-dd2f-4e89-b82f-c8a87b4b587e", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_af_events", "compiled": true, "compiled_code": "SELECT\n    af.id,\n    af.appsflyer_id,\n    -- , af_id.user_id\n    media_source,\n    af_channel,\n    campaign,\n    country_code,\n    af.ip,\n    af.platform,\n    af.device_type,\n    af.os_version,\n    af.app_version,\n    af.sdk_version,\n    af.app_id,\n    af.app_name,\n    af.bundle_id,\n    af.event_name,\n    af.event_value,\n    af.device_model,\n    af.device_brand,\n    af.event_type,\n    af.event_time_dt,\n    af.install_time_dt,\n    af.store_reinstall,\n    af.install_app_store\nFROM `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\nWHERE af.event_time_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_af_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:52.598942Z", "completed_at": "2024-05-03T19:52:52.604787Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:52.645885Z", "completed_at": "2024-05-03T19:52:53.511016Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.9308364391326904, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "c67e03e2-a547-44e4-870b-245987e24e4c", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_users", "compiled": true, "compiled_code": "select\n    user_id,\n    country_code,\n    registered_dt\nfrom\n    `analytics-147612`.`wh_raw`.`users`\nwhere registered_dt >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_users`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:52.591270Z", "completed_at": "2024-05-03T19:52:52.603199Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:52.634848Z", "completed_at": "2024-05-03T19:52:53.535706Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.9574120044708252, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "74bffa55-efb7-49af-a7de-622231957ede", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_pushes", "compiled": true, "compiled_code": "SELECT\n  *\nFROM\n  (\n    SELECT\n      *,\n      CASE\n        WHEN event_number = 1 THEN timestamp\n      END AS first_push\n    FROM\n      (\n        SELECT\n          *\n        FROM\n          (\n            SELECT\n              internal_customer_id,\n              SAFE_CAST(user_id AS INT64) as user_id,\n              timestamp,\n              campaign_id,\n              action_id,\n              type,\n              properties.campaign_name,\n              properties.status,\n              properties.error,\n              properties.action_name,\n              properties.action_type,\n              properties.variant,\n              properties.platform,\n              ROW_NUMBER() OVER (\n                PARTITION BY user_id\n                ORDER BY\n                  timestamp ASC\n              ) AS event_number\n            FROM\n              bloomreach_raw.campaign\n            WHERE\n              timestamp >= '2024-01-01'\n          )\n        WHERE\n          SAFE_CAST(user_id AS INT64) IN (\n            SELECT\n              user_id\n            FROM\n              (\n                WITH u AS (\n                  SELECT\n                    DISTINCT user_id\n                  FROM\n                    wh_raw.users\n                  WHERE\n                    EXTRACT(\n                      YEAR\n                      FROM\n                        registered_dt\n                    ) = 2024\n                ),\n                b AS (\n                  SELECT\n                    DISTINCT SAFE_CAST(user_id AS INT64) AS user_id\n                  FROM\n                    bloomreach_raw.campaign\n                  WHERE\n                    DATE(timestamp) BETWEEN '2024-01-01'\n                    AND DATE(CURRENT_TIMESTAMP)\n                    AND SAFE_CAST(user_id AS INT64) IN (\n                      SELECT\n                        user_id\n                      FROM\n                        u\n                    )\n                    AND properties.action_type = 'mobile notification'\n                    AND properties.status = 'delivered'\n                )\n                SELECT\n                  *\n                FROM\n                  b\n              )\n          )\n          AND action_type = 'mobile notification'\n          AND DATE(timestamp) BETWEEN '2024-01-01'\n          AND DATE(CURRENT_TIMESTAMP)\n          AND status IN ('delivered', 'failed')\n      )\n  ) AS `int_pushes`", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:52.595463Z", "completed_at": "2024-05-03T19:52:52.601988Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:52.606671Z", "completed_at": "2024-05-03T19:52:53.651924Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.0723028182983398, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "ffa1f3b7-2a81-4eb0-8aa3-6f28670b2a1e", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_bloomreach_events", "compiled": true, "compiled_code": "\n\nSELECT\n    internal_customer_id\n    , SAFE_CAST(user_id AS INT64) as user_id\n    , timestamp\n    , campaign_id\n    , action_id\n    , type\n    , properties.campaign_name\n    , properties.status\n    , properties.error\n    , properties.action_name\n    , properties.action_type\n    , properties.variant\n    , properties.platform\n    , ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY timestamp ASC) AS event_number\nFROM bloomreach_raw.campaign\nWHERE timestamp >= '2024-01-01'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:53.662697Z", "completed_at": "2024-05-03T19:52:53.666403Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:53.670272Z", "completed_at": "2024-05-03T19:52:54.586564Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 0.9297938346862793, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "e01b99a9-03f3-4cc8-bc1e-28c0a508c5f1", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.stg_pushes", "compiled": true, "compiled_code": "select ue.*\nfrom `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` as ue\nwhere\n    action_type = 'mobile notification'\n    and status in ('delivered', 'clicked', 'failed')", "relation_name": "`analytics-147612`.`dev_gsokolov`.`stg_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:53.659374Z", "completed_at": "2024-05-03T19:52:53.665338Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:53.666937Z", "completed_at": "2024-05-03T19:52:54.753114Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 1.0969860553741455, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "2445f3a3-3c11-46da-8847-381fa19be92b", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_bloomreach_events_enhanced", "compiled": true, "compiled_code": "select\n    c.*,\n    u.country_code,\n    u.registered_dt\nfrom `analytics-147612`.`dev_gsokolov`.`stg_bloomreach_events` as c\ninner join `analytics-147612`.`dev_gsokolov`.`stg_users` as u\n    on\n        safe_cast(c.user_id as integer) = u.user_id\n        and timestamp_trunc(\n            c.timestamp, day\n        ) between u.registered_dt and u.registered_dt\n        + interval 28 day", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:52.584041Z", "completed_at": "2024-05-03T19:52:52.603739Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:52.637573Z", "completed_at": "2024-05-03T19:52:55.408294Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.8313071727752686, "adapter_response": {"_message": "CREATE TABLE (257.0 rows, 10.9 KiB processed)", "code": "CREATE TABLE", "rows_affected": 257, "bytes_processed": 11188, "bytes_billed": 20971520, "location": "EU", "project_id": "analytics-147612", "job_id": "0b49c31b-03e3-4acd-86e0-26e3beac7d6d", "slot_ms": 1755}, "message": "CREATE TABLE (257.0 rows, 10.9 KiB processed)", "failures": null, "unique_id": "model.dbt_octafx.countries", "compiled": true, "compiled_code": "\n\nSELECT\n    c.country,\n    c.code,\n    ct.tier,\n    concat(\"Tier \", ct.tier_id) AS tier_name\nFROM `analytics-147612`.`wh_raw`.`countries` AS c\nLEFT JOIN\n    `analytics-147612`.`wh_raw`.`countries_tiers` AS ct\n    ON c.country = ct.country", "relation_name": "`analytics-147612`.`dev_gsokolov`.`countries`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:54.592738Z", "completed_at": "2024-05-03T19:52:54.595565Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:54.596382Z", "completed_at": "2024-05-03T19:52:55.598196Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.0073232650756836, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "8513b9e1-0fb5-4bc0-93ab-b69dbeb87687", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_notreg_pushes", "compiled": true, "compiled_code": "select *\nfrom `analytics-147612`.`dev_gsokolov`.`stg_pushes`\nwhere status = 'failed' and error = 'NotRegistered'", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:54.757925Z", "completed_at": "2024-05-03T19:52:54.761182Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:54.762008Z", "completed_at": "2024-05-03T19:52:55.820875Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.0649001598358154, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "d74b20ff-4a39-48b1-a09e-40e481ce23f1", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_af_id", "compiled": true, "compiled_code": "SELECT\n    cast(user_id AS numeric) AS user_id,\n    client_id AS appsflyer_id,\n    af.install_time_dt\nFROM (\n    SELECT\n        *,\n        row_number() OVER (PARTITION BY user_id ORDER BY dt DESC) AS row_num\n    FROM `analytics-147612`.`wh_raw`.`users_cids_all`\n    WHERE\n        user_id IN (\n            SELECT DISTINCT user_id\n            FROM `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n        )\n) AS s\nINNER JOIN `analytics-147612`.`wh_raw`.`mobile_appsflyer` AS af\n    ON\n        s.client_id = af.appsflyer_id\n        AND af.event_time_dt >= '2024-01-01'\nWHERE s.row_num = 1", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_af_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:55.603615Z", "completed_at": "2024-05-03T19:52:55.606769Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:55.607771Z", "completed_at": "2024-05-03T19:52:56.514437Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 0.9130914211273193, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "d199881c-63f5-4997-b83e-39006cc2577d", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_notreg_user_id", "compiled": true, "compiled_code": "with\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes`\n    where error = \"NotRegistered\"\n    group by user_id\n)\n\nselect distinct\n    uep.user_id,\n    fnr.first_error_timestamp\nfrom `analytics-147612`.`dev_gsokolov`.`int_notreg_pushes` as uep\ninner join first_not_registered as fnr on uep.user_id = fnr.user_id\ngroup by 1, 2", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:55.826463Z", "completed_at": "2024-05-03T19:52:55.829598Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:55.830476Z", "completed_at": "2024-05-03T19:52:56.932918Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 1.1084332466125488, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "EU", "project_id": "analytics-147612", "job_id": "97645aa5-c5ad-41f3-998f-816f800562ab", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.dbt_octafx.int_users_af", "compiled": true, "compiled_code": "select\n    u.*,\n    af.appsflyer_id,\n    af.install_time_dt\nfrom `analytics-147612`.`dev_gsokolov`.`stg_users` as u\ninner join\n    `analytics-147612`.`dev_gsokolov`.`int_af_id` as af\n    on u.user_id = af.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_users_af`"}, {"status": "error", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:56.521203Z", "completed_at": "2024-05-03T19:52:56.529122Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:56.530540Z", "completed_at": "2024-05-03T19:52:58.208986Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.6943895816802979, "adapter_response": {}, "message": "Database Error in model int_events_enum (models/push_problem/intermediate/int_events_enum.sql)\n  Column name event_number is ambiguous at [24:13]\n  compiled Code at target/run/dbt_octafx/models/push_problem/intermediate/int_events_enum.sql", "failures": null, "unique_id": "model.dbt_octafx.int_events_enum", "compiled": true, "compiled_code": "with\nevents as (\n    select\n        *,\n        row_number() over (\n            partition by user_id order by cast(timestamp as datetime)\n        ) as event_number\n    from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n    where\n        user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`\n        )\n        and status in ('delivered', 'clicked', 'failed')\n),\n\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp,\n        min(event_number) as first_error_event_number\n    from events\n    where error = 'NotRegistered'\n    group by user_id\n)\n\nselect\n    cast(e.user_id as numeric) as user_id,\n    country_code,\n    registered_dt,\n    status,\n    campaign_id,\n    consent_category,\n    sent_timestamp,\n    action_name,\n    action_id,\n    campaign_name,\n    platform,\n    campaign_trigger,\n    action_type,\n    ingest_timestamp,\n    timestamp,\n    type,\n    fnr.first_error_timestamp,\n    cast(fnr.first_error_event_number as numeric) as first_error_event_number\nfrom events as e\nleft join first_not_registered as fnr on e.user_id = fnr.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_events_enum`"}, {"status": "error", "timing": [{"name": "compile", "started_at": "2024-05-03T19:52:56.524709Z", "completed_at": "2024-05-03T19:52:56.530038Z"}, {"name": "execute", "started_at": "2024-05-03T19:52:56.533758Z", "completed_at": "2024-05-03T19:52:58.907020Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.389709234237671, "adapter_response": {}, "message": "Database Error in model int_pushes_enum (models/push_problem/intermediate/int_pushes_enum.sql)\n  Column name event_number is ambiguous at [27:13]\n  compiled Code at target/run/dbt_octafx/models/push_problem/intermediate/int_pushes_enum.sql", "failures": null, "unique_id": "model.dbt_octafx.int_pushes_enum", "compiled": true, "compiled_code": "with\npushes as (\n    select\n        *,\n        row_number() over (\n            partition by user_id order by cast(timestamp as datetime)\n        ) as event_number\n    from `analytics-147612`.`dev_gsokolov`.`int_bloomreach_events_enhanced`\n    where\n        user_id in (select distinct user_id from `analytics-147612`.`dev_gsokolov`.`int_notreg_user_id`\n        )\n        and (\n            action_type = 'mobile notification'\n            and status in ('delivered', 'clicked', 'failed')\n        )\n),\n\nfirst_not_registered as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp,\n        min(event_number) as first_error_event_number\n    from pushes\n    where error = 'NotRegistered'\n    group by user_id\n),\n\nfirst_error_event as (\n    select\n        user_id,\n        min(cast(timestamp as datetime)) as first_error_timestamp\n    from\n        pushes\n    where\n        error = 'NotRegistered'\n    group by\n        user_id\n),\n\nnext_delivered_event as (\n    select\n        e.user_id,\n        min(cast(e.timestamp as datetime)) as next_delivered_timestamp\n    from\n        pushes as e\n    inner join\n        first_error_event as fee\n        on e.user_id = fee.user_id\n    where\n        e.status = 'delivered'\n        and cast(e.timestamp as datetime) > fee.first_error_timestamp\n    group by\n        e.user_id\n)\n\nselect\n    fee.user_id,\n    fee.first_error_timestamp,\n    nde.next_delivered_timestamp,\n    date_diff(nde.next_delivered_timestamp, fee.first_error_timestamp, second)\n        as time_difference_in_seconds\nfrom\n    first_error_event as fee\nleft join\n    next_delivered_event as nde\n    on fee.user_id = nde.user_id", "relation_name": "`analytics-147612`.`dev_gsokolov`.`int_pushes_enum`"}], "elapsed_time": 7.118832111358643, "args": {"print": true, "profile": "user", "introspect": true, "select": ["push_problem"], "printer_width": 80, "quiet": false, "write_json": true, "log_format_file": "json", "include_saved_query": false, "show": false, "partial_parse_file_diff": true, "populate_cache": true, "favor_state": false, "partial_parse": true, "enable_legacy_logger": false, "use_colors": true, "target_path": "target", "log_file_max_bytes": 10485760, "cache_selected_only": false, "macro_debugging": false, "log_path": "logs", "exclude": [], "send_anonymous_usage_stats": true, "use_colors_file": true, "project_dir": "/app/dbt_project/140496a9-19ac-4166-926a-610a826f6fdf", "show_resource_report": false, "warn_error_options": {"include": [], "exclude": []}, "log_level": "info", "static_parser": true, "strict_mode": false, "resource_types": [], "indirect_selection": "eager", "which": "build", "log_format": "json", "state": "__state", "profiles_dir": "./", "log_level_file": "debug", "defer": true, "version_check": true, "vars": {}, "invocation_command": "dbt "}}