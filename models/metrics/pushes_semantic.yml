version: 2
semantic_models:
  - name: pushes_cnt
    model: ref('int_pushes')
    description: "A semantic model representing bloomreach events data"
    defaults:
      agg_time_dimension: timestamp
    entities:
      - name: user_id
        type: primary
    measures:
      - name: events_cnt
        expr: 1
        agg: count
    dimensions:
      - name: timestamp
        type: time
        type_params:
          time_granularity: day
      - name: action_type
        type: categorical
      - name: status
        type: categorical
      - name: error
        type: categorical

metrics:
  - name: events_cnt
    type: simple
    label: total count of bloomreach events
    type_params:
      measure: events_cnt
  - name: pushes_cnt
    type: simple
    label: total count of push events
    type_params:
      measure: events_cnt
    filter: |
      {{ Dimension('user_id__action_type') }}  = 'mobile notification'
      AND {{ Dimension('user_id__status') }} in ('clicked', 'delivered', 'failed')
  - name: cumulative_pushes_total_l1m  #For this metric, we use a window of 1 month 
    label: Cumulative pushes total (L1M)
    description: Trailing 1-month cumulative order amount
    type: cumulative
    type_params:
      measure: pushes_cnt
      window: 1 month
  - name: cumulative_pushes_total_mtd   #For this metric, we use a monthly grain-to-date 
    label: Cumulative pushes total (MTD)
    description: The month-to-date value of all orders
    type: cumulative
    type_params:
      measure: pushes_cnt
      grain_to_date: month