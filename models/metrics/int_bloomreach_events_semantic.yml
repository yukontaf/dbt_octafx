version: 2
semantic_models:
  - name: bloomreach_events
    model: ref('int_bloomreach_events_enhanced')
    description: "A semantic model representing bloomreach events data"
    defaults:
      agg_time_dimension: timestamp
    entities:
      - name: user_id
        type: primary
    measures:
      - name: events_cnt
        expr: 1
        agg: count
    dimensions:
      - name: timestamp
        type: time
        type_params:
          time_granularity: day
      - name: action_type
        type: categorical
      - name: status
        type: categorical
      - name: error
        type: categorical

metrics:
  - name: events_cnt
    type: simple
    label: total count of bloomreach events
    type_params:
      measure: events_cnt
  - name: pushes_cnt
    type: simple
    label: total count of push events
    type_params:
      measure: events_cnt
    filter: |
      {{ Dimension('user_id__action_type') }}  = 'mobile notification'
      AND {{ Dimension('user_id__status') }} in ('clicked', 'delivered', 'failed')
